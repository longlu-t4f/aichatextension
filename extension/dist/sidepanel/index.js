import{i as O,a as P,M as b}from"../assets/messaging-CgRh-b1E.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))d(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&d(s)}).observe(document,{childList:!0,subtree:!0});function A(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function d(t){if(t.ep)return;t.ep=!0;const r=A(t);fetch(t.href,r)}})();const l="ai-chat-iframe-bridge",E="AI_CHAT_IFRAME_READY",T="AI_CHAT_HOST_READY",p="AI_CHAT_PREFILL_REQUEST",w="AI_CHAT_PREFILL_EVENT",h="AI_CHAT_OPEN_OPTIONS";function S(e){return typeof e=="object"&&e!==null&&"channel"in e&&e.channel===l&&"type"in e&&typeof e.type=="string"}function N(e){return e.type===E||e.type===p||e.type===h}const m="http://localhost:5173/",F=[];function M(e){try{return new URL(e).origin}catch{return}}const U=M(m),u=m,H=Array.from(new Set([...F,U].filter(e=>typeof e=="string"&&e.length>0)));function v(e){try{const n=new URL(u);return e!=null&&n.searchParams.set("tabId",String(e)),n.toString()}catch{return u}}const i=document.getElementById("ai-chat-frame");if(!i)throw new Error("缺少 iframe 容器，无法初始化侧边栏宿主。");const D=document.getElementById("host-loading"),C=new URLSearchParams(window.location.search),f=Number(C.get("tabId")??""),o=Number.isFinite(f)?f:void 0,I=v(o);i.src=I;const g=new Set(H),a=Y(I);a&&g.add(a);let y=!1,c=null;window.addEventListener("message",e=>{if(e.source!==i.contentWindow||!g.has(e.origin)||!S(e.data)||!N(e.data))return;const n=e.data;B(n)});chrome.runtime.onMessage.addListener(e=>!O(e)||!P(e)||!G(e)?!1:(c=e,L(),!0));R();function B(e){switch(e.type){case E:y=!0,W(),_({channel:l,type:T,payload:{tabId:o}}),L();break;case p:R();break;case h:chrome.runtime.openOptionsPage().catch(()=>{});break}}function L(){if(!y||!c)return;const{text:e,autoSend:n}=c;_({channel:l,type:w,payload:{text:e,autoSend:n}}),c=null}function G(e){return o?e.tabId==null||e.tabId===o:!0}function _(e){if(!i.contentWindow)return;const n=a??"*";i.contentWindow.postMessage(e,n)}function R(){chrome.runtime.sendMessage({type:b,tabId:o}).catch(()=>{})}function W(){D?.classList.add("hidden")}function Y(e){if(e)try{return new URL(e).origin}catch{return}}
