import{i as h,a as p,c as g,d as P,e as L,P as v}from"./assets/messaging-A4bD3-tz.js";const s=new Map,r=new Map;let i=!1,a;function c(){chrome.windows.getCurrent({populate:!0},e=>{a=e.id})}function C(){chrome.sidePanel.setOptions({enabled:!1}).then(()=>{chrome.sidePanel.setOptions({enabled:!0}).catch(()=>{})}).catch(()=>{})}async function O(e){e===void 0&&(e=a),e&&chrome.sidePanel.open({windowId:e}).catch(()=>{})}function l(){i=!i,i?O(void 0):C()}c();chrome.windows.onFocusChanged.addListener(e=>{e!==chrome.windows.WINDOW_ID_NONE&&(a=e)});chrome.windows.onCreated.addListener(()=>{c()});chrome.windows.onRemoved.addListener(()=>{c()});chrome.runtime.onInstalled.addListener(async()=>{await chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0})});chrome.action.onClicked.addListener(()=>{l()});chrome.webNavigation.onCommitted.addListener(e=>{e.documentId&&r.set(e.documentId,e.tabId)});chrome.tabs.onRemoved.addListener(e=>{s.delete(e);for(const[n,t]of r.entries())t===e&&r.delete(n)});chrome.runtime.onMessage.addListener((e,n)=>{if(!h(e))return!1;if(p(e)){const t=e,o=u(t.tabId,n);return o==null?!1:(b(t,o),!0)}if(g(e)){const o=u(e.tabId,n);return o==null?!1:(f(o,void 0,{dropAfterSend:!0}),!0)}return P(e)?(i=!0,!0):L(e)?(l(),!0):!1});chrome.runtime.onConnect.addListener(e=>{e.name===v&&e.onDisconnect.addListener(()=>{i=!1})});function u(e,n){if(e!=null)return e;if(n.tab?.id!=null)return n.tab.id;if(n.documentId){const t=r.get(n.documentId);if(t!=null)return t}}function b(e,n){const t={...e,tabId:n};s.set(n,t),i||l(),f(n,t,{dropAfterSend:!1})}function f(e,n,t){const o=n??s.get(e);if(!o)return;const m=t?.dropAfterSend??!0;chrome.runtime.sendMessage(o).then(()=>{m&&s.get(e)===o&&s.delete(e)},d=>{d&&typeof d.message=="string"&&d.message.includes("Receiving end does not exist")})}
